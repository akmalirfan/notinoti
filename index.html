<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>notinoti</title>

        <style>
            input {
                display: block;
            }
        </style>
    </head>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/barcodes/JsBarcode.code128.min.js"></script>
        <img id="img" />

        <input type="text" id="noti_title" placeholder="Notification title" />
        <input type="text" id="noti_body" placeholder="Notification body" />
        <input
            type="text"
            id="noti_barcode"
            placeholder="CODE128 barcode"
            onchange="generateBarcode(this);"
        />
        <input type="file" onchange="getDataURL(this);" />
        <input
            type="button"
            onclick="triggerNotification();"
            value="Show notification"
        />

        <script>
            navigator.serviceWorker.register("sw.js")

            document.body.onload = () => {
                Notification.requestPermission()
            }

            generateBarcode = (input) => JsBarcode("#img", input.value)

            getDataURL = (input) => {
                if (input.files && input.files[0]) {
                    let reader = new FileReader()

                    reader.onload = (e) =>
                        (document.querySelector("#img").src = e.target.result)

                    reader.readAsDataURL(input.files[0])
                }
            }

            triggerNotification = () => {
                navigator.serviceWorker.ready.then((registration) => {
                    registration.showNotification(
                        document.querySelector("#noti_title").value,
                        {
                            body: document.querySelector("#noti_body").value,
                            image: document.querySelector("#img").src,
                        }
                    )
                })
            }
        </script>
    </body>
</html>
